var t=function(){if("undefined"==typeof document)return"transform";for(var t=["oTransform","msTransform","mozTransform","webkitTransform","transform"],i=document.createElement("div").style,e=0;e<t.length;e++)if(t[e]in i)return t[e];return"transform"}();function i(t){var i=document.createElement("div");if(i.style.cssText="position:absolute;","function"==typeof t.render){var e=t.render();if(e instanceof HTMLElement)return i.appendChild(e),i}if(i.textContent=t.text,t.style)for(var n in t.style)i.style[n]=t.style[n];return i}var e={name:"dom",init:function(){var t=document.createElement("div");return t.style.cssText="overflow:hidden;white-space:nowrap;transform:translateZ(0);",t},clear:function(t){for(var i=t.lastChild;i;)t.removeChild(i),i=t.lastChild},resize:function(t,i,e){t.style.width=i+"px",t.style.height=e+"px"},framing:function(){},setup:function(t,e){var n=document.createDocumentFragment(),s=0,r=null;for(s=0;s<e.length;s++)(r=e[s]).node=r.node||i(r),n.appendChild(r.node);for(e.length&&t.appendChild(n),s=0;s<e.length;s++)(r=e[s]).width=r.width||r.node.offsetWidth,r.height=r.height||r.node.offsetHeight},render:function(i,e){e.node.style[t]="translate("+e.x+"px,"+e.y+"px)"},remove:function(t,i){t.removeChild(i.node),this.media||(i.node=null)}},n=function(){if("undefined"!=typeof window){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame;if(t)return t.bind(window)}return function(t){return setTimeout(t,50/3)}}(),s=function(){if("undefined"!=typeof window){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame;if(t)return t.bind(window)}return clearTimeout}();function r(t,i,e){for(var n=0,s=0,r=t.length;s<r-1;)e>=t[n=s+r>>1][i]?s=n:r=n;return t[s]&&e<t[s][i]?s:r}function h(t){return/^(ltr|top|bottom)$/i.test(t)?t.toLowerCase():"rtl"}function o(){var t=9007199254740991;return[{range:0,time:-t,width:t,height:0},{range:t,time:t,width:0,height:0}]}function a(t){t.ltr=o(),t.rtl=o(),t.top=o(),t.bottom=o()}function d(){return void 0!==window.performance&&window.performance.now?window.performance.now():Date.now()}function u(t){var i=this,e=this.media?this.media.currentTime:d()/1e3,n=this.media?this.media.playbackRate:1;function s(t,s){if("top"===s.mode||"bottom"===s.mode)return e-t.time<i._.duration;var r=(i._.width+t.width)*(e-t.time)*n/i._.duration;if(t.width>r)return!0;var h=i._.duration+t.time-e,o=i._.width+s.width,a=i.media?s.time:s._utc,d=o*(e-a)*n/i._.duration,u=i._.width-d;return h>i._.duration*u/(i._.width+s.width)}for(var r=this._.space[t.mode],h=0,o=0,a=1;a<r.length;a++){var u=r[a],m=t.height;if("top"!==t.mode&&"bottom"!==t.mode||(m+=u.height),u.range-u.height-r[h].range>=m){o=a;break}s(u,t)&&(h=a)}var c=r[h].range,l={range:c+t.height,time:this.media?t.time:t._utc,width:t.width,height:t.height};return r.splice(h+1,o-h-1,l),"bottom"===t.mode?this._.height-t.height-c%this._.height:c%(this._.height-t.height)}function m(){if(!this._.visible||!this._.paused)return this;if(this._.paused=!1,this.media)for(var t=0;t<this._.runningList.length;t++){var i=this._.runningList[t];i._utc=d()/1e3-(this.media.currentTime-i.time)}var e=this,s=function(t,i,e,n){return function(s){t(this._.stage);var r=(s||d())/1e3,h=this.media?this.media.currentTime:r,o=this.media?this.media.playbackRate:1,a=null,m=0,c=0;for(c=this._.runningList.length-1;c>=0;c--)a=this._.runningList[c],h-(m=this.media?a.time:a._utc)>this._.duration&&(n(this._.stage,a),this._.runningList.splice(c,1));for(var l=[];this._.position<this.comments.length&&(a=this.comments[this._.position],!((m=this.media?a.time:a._utc)>=h));)h-m>this._.duration||(this.media&&(a._utc=r-(this.media.currentTime-a.time)),l.push(a)),++this._.position;for(i(this._.stage,l),c=0;c<l.length;c++)(a=l[c]).y=u.call(this,a),this._.runningList.push(a);for(c=0;c<this._.runningList.length;c++){a=this._.runningList[c];var f=(this._.width+a.width)*(r-a._utc)*o/this._.duration;"ltr"===a.mode&&(a.x=f-a.width),"rtl"===a.mode&&(a.x=this._.width-f),"top"!==a.mode&&"bottom"!==a.mode||(a.x=this._.width-a.width>>1),e(this._.stage,a)}}}(this._.engine.framing.bind(this),this._.engine.setup.bind(this),this._.engine.render.bind(this),this._.engine.remove.bind(this));return this._.requestID=n((function t(i){s.call(e,i),e._.requestID=n(t)})),this}function c(){return!this._.visible||this._.paused||(this._.paused=!0,s(this._.requestID),this._.requestID=0),this}function l(){if(!this.media)return this;this.clear(),a(this._.space);var t=r(this.comments,"time",this.media.currentTime);return this._.position=Math.max(0,t-1),this}function f(t){t.play=m.bind(this),t.pause=c.bind(this),t.seeking=l.bind(this),this.media.addEventListener("play",t.play),this.media.addEventListener("pause",t.pause),this.media.addEventListener("playing",t.play),this.media.addEventListener("waiting",t.pause),this.media.addEventListener("seeking",t.seeking)}function p(t){this.media.removeEventListener("play",t.play),this.media.removeEventListener("pause",t.pause),this.media.removeEventListener("playing",t.play),this.media.removeEventListener("waiting",t.pause),this.media.removeEventListener("seeking",t.seeking),t.play=null,t.pause=null,t.seeking=null}function _(t){this._={},this.container=t.container||document.createElement("div"),this.media=t.media,this._.visible=!0,this.engine="dom",this._.engine=e,this._.requestID=0,this._.speed=Math.max(0,t.speed)||144,this._.duration=4,this.comments=t.comments||[],this.comments.sort((function(t,i){return t.time-i.time}));for(var i=0;i<this.comments.length;i++)this.comments[i].mode=h(this.comments[i].mode);return this._.runningList=[],this._.position=0,this._.paused=!0,this.media&&(this._.listener={},f.call(this,this._.listener)),this._.stage=this._.engine.init(this.container),this._.stage.style.cssText+="position:relative;pointer-events:none;",this.resize(),this.container.appendChild(this._.stage),this._.space={},a(this._.space),this.media&&this.media.paused||(l.call(this),m.call(this)),this}function g(){if(!this.container)return this;for(var t in c.call(this),this.clear(),this.container.removeChild(this._.stage),this.media&&p.call(this,this._.listener),this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=null);return this}var v=["mode","time","text","render","style"];function w(t){if(!t||"[object Object]"!==Object.prototype.toString.call(t))return this;for(var i={},e=0;e<v.length;e++)void 0!==t[v[e]]&&(i[v[e]]=t[v[e]]);if(i.text=(i.text||"").toString(),i.mode=h(i.mode),i._utc=d()/1e3,this.media){var n=0;void 0===i.time?(i.time=this.media.currentTime,n=this._.position):(n=r(this.comments,"time",i.time))<this._.position&&(this._.position+=1),this.comments.splice(n,0,i)}else this.comments.push(i);return this}function y(){return this._.visible?this:(this._.visible=!0,this.media&&this.media.paused||(l.call(this),m.call(this)),this)}function b(){return this._.visible?(c.call(this),this.clear(),this._.visible=!1,this):this}function L(){return this._.engine.clear(this._.stage,this._.runningList),this._.runningList=[],this}function x(){return this._.width=this.container.offsetWidth,this._.height=this.container.offsetHeight,this._.engine.resize(this._.stage,this._.width,this._.height),this._.duration=this._.width/this._.speed,this}var T={get:function(){return this._.speed},set:function(t){return"number"!=typeof t||isNaN(t)||!isFinite(t)||t<=0?this._.speed:(this._.speed=t,this._.width&&(this._.duration=this._.width/t),t)}};function E(t){t&&_.call(this,t)}E.prototype.destroy=function(){return g.call(this)},E.prototype.emit=function(t){return w.call(this,t)},E.prototype.show=function(){return y.call(this)},E.prototype.hide=function(){return b.call(this)},E.prototype.clear=function(){return L.call(this)},E.prototype.resize=function(){return x.call(this)},Object.defineProperty(E.prototype,"speed",T);export default E;
